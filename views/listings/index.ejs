<% layout('layouts/boilerplate') %>

  <!-- SCROLLABLE FILTERS -->
<div class="filter-wrapper">

  <!-- LEFT ARROW -->
  <button id="left-arrow" class="arrow-btn">‹</button>

  <!-- FILTERS VISIBLE ONLY TILL BEACH -->
  <div id="filters" class="filters-scroll">
  <a href="/listings/category/trending" class="filter"><i class="fa-solid fa-fire"></i><p>Trending</p></a>
  <a href="/listings/category/rooms" class="filter"><i class="fa-solid fa-bed"></i><p>Rooms</p></a>
  <a href="/listings/category/iconic-cities" class="filter"><i class="fa-solid fa-city"></i><p>Iconic Cities</p></a>
  <a href="/listings/category/mountains" class="filter"><i class="fa-solid fa-mountain"></i><p>Mountains</p></a>
  <a href="/listings/category/pools" class="filter"><i class="fa-solid fa-person-swimming"></i><p>Amazing Pools</p></a>
  <a href="/listings/category/castles" class="filter"><i class="fa-brands fa-fort-awesome"></i><p>Castles</p></a>
  <a href="/listings/category/camping" class="filter"><i class="fa-solid fa-tents"></i><p>Camping</p></a>
  <a href="/listings/category/farms" class="filter"><i class="fa-solid fa-cow"></i><p>Farms</p></a>
  <a href="/listings/category/snow" class="filter"><i class="fa-solid fa-snowman"></i><p>Snow Place</p></a>
  <a href="/listings/category/historical" class="filter"><i class="fa-solid fa-monument"></i><p>Historical</p></a>
  <a href="/listings/category/beach" class="filter"><i class="fa-solid fa-umbrella-beach"></i><p>Beach</p></a>
  <a href="/listings/category/family" class="filter"><i class="fa-solid fa-people-group"></i><p>Family Trips</p></a>
  <a href="/listings/category/adventure" class="filter"><i class="fa-solid fa-person-hiking"></i><p>Adventure</p></a>
  <a href="/listings/category/environmental" class="filter"><i class="fa-solid fa-leaf"></i><p>Eco Stays</p></a>
  <a href="/listings/category/island" class="filter"><i class="fa-solid fa-water"></i><p>Island Stays</p></a>
  <a href="/listings/category/desert" class="filter"><i class="fa-solid fa-mountain-sun"></i><p>Desert</p></a>
  <a href="/listings/category/jungle-safari" class="filter"><i class="fa-solid fa-binoculars"></i><p>Jungle Safari</p></a>
  <a href="/listings/category/treehouse" class="filter"><i class="fa-solid fa-tree"></i><p>Treehouse</p></a>
</div>


  <!-- RIGHT ARROW  ➜ will be placed exactly at Beach end -->
  <button id="right-arrow" class="arrow-btn">›</button>

<div class="right-controls">
  <div class="tax-box">
    <span class="tax-label">Display After Adding Tax</span>
    <label class="switch">
      <input type="checkbox" id="taxSwitch">
      <span class="slider round"></span>
    </label>
  </div>

  <div class="sort-box">
    <label>Sort By:</label>
    <select id="sortSelect">
      <option value="recommended">Recommended</option>
      <option value="lowToHigh">Price: Low to High</option>
      <option value="highToLow">Price: High to Low</option>
      <option value="newest">Newest Listings</option>
    </select>
  </div>
</div>

</div>



<!-- LISTINGS DISPLAY -->
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mt-4">
  <% for (let listing of allListings) { %>
    <div class="col">
      <div class="card listing-card border-0 shadow-sm position-relative">

        <!-- Image -->
        <a href="/listings/<%= listing._id %>">
          <img src="<%= listing.image.url %>" class="card-img-top listing-img" alt="Listing Image">
        </a>

        <div class="card-body">
          <!-- Title -->
          <h5 class="card-title"><%= listing.title %></h5>

          <!-- ⭐ Rating -->
          <% if (listing.averageRating) { %>
            <div class="rating-stars mb-1">
              <% for (let i = 1; i <= 5; i++) { %>
                <% if (i <= Math.floor(listing.averageRating)) { %>
                  <i class="fa-solid fa-star"></i>
                <% } else if (i - listing.averageRating < 1) { %>
                  <i class="fa-solid fa-star-half-stroke"></i>
                <% } else { %>
                  <i class="fa-regular fa-star"></i>
                <% } %>
              <% } %>
              <span class="rating-text ms-1">(<%= listing.averageRating %>)</span>
            </div>
          <% } else { %>
            <p class="rating-text text-muted mb-1">No Rating Yet</p>
          <% } %>

          <!-- Price -->
          <p class="price-line">
            ₹ <%= listing.price.toLocaleString("en-IN") %> / night
            <span class="gst-text">&nbsp;+18% GST</span>
          </p>

          <!-- ❤️ Wishlist Button (Bottom Right) -->
          <button class="heart-btn" data-id="<%= listing._id %>">
            <% if (currUser && currUser.wishlist.includes(listing._id)) { %>
              <i class="fa-solid fa-heart liked"></i>
            <% } else { %>
              <i class="fa-regular fa-heart"></i>
            <% } %>
          </button>
        </div>

      </div>
    </div>
  <% } %>
</div>







<style>
.filter-wrapper {
  display: flex;
  align-items: center;
  gap: 1.2rem;
  padding: 18px 2%;
  max-width: 95% ;
  margin: auto;
  /* margin-left: -10px; */
}

.filters-scroll {
  display: flex;
  overflow-x: auto;
  gap: 2rem;
  scrollbar-width: none;
  white-space: nowrap;
  flex: 1;
  max-width: 60%;
}
.filters-scroll::-webkit-scrollbar { display: none; }

.filter {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-decoration: none;
  gap: 6px;
  font-size: 13px;
  color: #717171;
  transition: 0.25s ease;
}

.filter i {
  font-size: 22px;
  opacity: 0.7;
}

.filter:hover,
.filter.active {
  color: black;
}

.filter:hover i,
.filter.active i {
  opacity: 1;
}

.arrow-btn {
  background: none;
  border: none;
  font-size: 28px;
  cursor: pointer;
  padding: 0 8px;
  font-weight: bold;
  align-items: center;
  margin-bottom: 20px;
}

.arrow-btn:hover { color: #ff385c; }


/* WRAPPER FOR TAX + SORT ON RIGHT SIDE */
/* FIX #1 → Move LEFT ARROW fully to the LEFT */
.arrow-btn:first-of-type {
    margin-left: -35px;     /* Push more left */
}

/* FIX #2 → Move both buttons more to the RIGHT */
.right-controls {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-left: auto;
    margin-right: -100px;     /* PUSH MORE RIGHT ⭐ */
}


/* TAX BOX */
.tax-box {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 14px;
  background: #f6f6f6;
  border-radius: 10px;
  border: 1px solid #dcdcdc;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  transition: all 0.3s ease;
  cursor: pointer;
  margin-bottom: 16px;
  font-size: 15px;
  margin-left: auto;
}

/* LABEL TEXT IN TAX BOX */
.tax-label {
  font-weight: 500;
  color: #444;
  opacity: 0.4;                 /* low opacity by default */
  transition: opacity 0.3s ease;
}

.tax-box:hover {
  background: #eeeeee;
  box-shadow: 0 10px 20px rgba(8, 159, 54, 0.12);
  transform: translateY(-2px);
}

.tax-box:hover .tax-label {
  opacity: 1;                   /* full opacity on hover */
}

/* ACTIVE STATE (IF YOU ADD .active VIA JS) */
.tax-box.active {
  background: #d6f5d6 !important;  /* light green */
  border-color: #41d441;
}

/* SWITCH BUTTON */
.switch {
  position: relative;
  display: inline-block;
  width: 48px;
  height: 24px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

/* SLIDER TRACK */
.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: #dcdcdc;
  transition: 0.4s;
  border-radius: 30px;
}

/* SLIDER KNOB */
.slider:before {
  content: "";
  position: absolute;
  height: 18px;
  width: 18px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: 0.4s;
  border-radius: 50%;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

/* WHEN SWITCH IS ON */
input:checked + .slider {
  background-color: #08ae4a;
}

input:checked + .slider:before {
  transform: translateX(24px);
}

/* SORT BOX – MAKE IT MATCH TAX BOX */
.sort-box {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 14px;
  border: 1px solid #ddd;
  border-radius: 10px;
  background: #f6f6f6;
  transition: 0.3s ease;
  margin-bottom: 16px;
}

/* Make label low opacity like tax button */
.sort-box label {
  font-weight: 500;
  color: #444;
  opacity: 0.4;
  transition: opacity 0.3s ease;
}

/* Hover effect: opacity full + shadow */
.sort-box:hover {
  background: #eeeeee;
  box-shadow: 0 10px 20px rgba(8, 159, 54, 0.12);
  transform: translateY(-2px);
}

.sort-box:hover label {
  opacity: 1;
}

/* Dropdown styling */
.sort-box select {
  border: none;
  background: transparent;
  font-size: 14px;
  outline: none;
  cursor: pointer;
}

.back-btn-wrapper {
  width: 100%;
  margin: 10px 0;
}

.back-btn {
  display: inline-block;
  padding: 8px 14px;
  background: #f6f6f6;
  border: 1px solid #ccc;
  border-radius: 10px;
  text-decoration: none;
  color: #444;
  font-size: 14px;
  transition: all 0.3s ease;
}

.back-btn:hover {
  background: #eeeeee;
  box-shadow: 0 10px 20px rgba(8,159,54,0.12);
  transform: translateY(-2px);
}

.card {
  position: relative;
}

.listing-img {
  height: 20rem;
  object-fit: cover;
  border-radius: 12px;
}

.heart-btn {
  background: none;
  border: none;
  font-size: 1.6rem;
  cursor: pointer;
  color: #d0d0d0;
  transition: 0.3s;
  position: absolute;
  bottom: 10px;
  right: 15px;
}

.heart-btn:hover { color: red; }
.liked { color: red !important; }

/* ⭐ Rating Styling */
.rating-stars {
  display: flex;
  align-items: center;
  margin-bottom: 4px;
}

.rating-stars i {
  color: #ffaa00;          /* Gold stars */
  font-size: 1rem;
  margin-right: 2px;
}

.rating-text {
  font-weight: 500;
  color: #555;
  font-size: 0.9rem;
}



</style>



<script>

const filters = document.getElementById("filters");

document.getElementById("right-arrow").addEventListener("click", () => {
  filters.scrollBy({ left: 250, behavior: "smooth" });
});
document.getElementById("left-arrow").addEventListener("click", () => {
  filters.scrollBy({ left: -250, behavior: "smooth" });
});

// ACTIVE FILTER
document.querySelectorAll(".filter").forEach(link => {
  link.addEventListener("click", function () {
    document.querySelectorAll(".filter").forEach(item => item.classList.remove("active"));
    this.classList.add("active");
  });
});

// GST Toggle
const taxSwitch = document.getElementById("taxSwitch");
const gstTexts = document.querySelectorAll(".gst-text");

taxSwitch.addEventListener("change", () => {
  gstTexts.forEach(el => {
    el.style.display = taxSwitch.checked ? "inline-block" : "none";
  });
});
gstTexts.forEach(el => {
  el.style.display = "none";
});

document.getElementById("sortSelect").addEventListener("change", function () {
  const value = this.value;
  if (value === "lowToHigh") window.location.href = "/listings?sort=priceAsc";
  if (value === "highToLow") window.location.href = "/listings?sort=priceDesc";
  if (value === "newest") window.location.href = "/listings?sort=newest";
  if (value === "recommended") window.location.href = "/listings";
});

 document.querySelectorAll(".heart-btn").forEach(btn => {
    btn.addEventListener("click", async function (e) {
      e.preventDefault();  // stop redirect

      const listingId = this.getAttribute("data-id");

      const res = await fetch(`/listings/${listingId}/wishlist`, {
        method: "POST"
      });

      if (res.ok) {  // toggle instantly
        const icon = this.querySelector("i");
        icon.classList.toggle("fa-regular");
        icon.classList.toggle("fa-solid");
        icon.classList.toggle("liked");
      } else {
        alert("Login required to add to wishlist!");
      }
    });
  });

</script>